name: Auto merge
on:
  push:
    branches:
      - '*'
      - '!main'
jobs:
  auto-merge:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: fetch and merge
        run: |
          git fetch --shallow-since "$(date -d "$(date +'%Y-%m-01') 1 month ago" +'%Y/%m/%d')"
          CURRENT_BRANCH=$(git name-rev --name-only HEAD)
          echo $CURRENT_BRANCH
          git switch main
          git merge --no-ff $CURRENT_BRANCH
          git log